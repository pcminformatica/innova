{% extends 'layout_main-drawer--dismissible_footer_topbar.html' %}
{% block page_description %}Innova Mujer Home, Casa, Dashboard, Home{% endblock %}
{% block page_title %}Innova Mujer Home{% endblock %}
{% block body %}
{% block css_script_section %}

<style>
.mdc-typography--body-2{
    font-size: 18px;
    font-weight:   bold;

}
@media screen and (max-width: 850px) {


.mdc-deprecated-list-item__text{
  font-size: 14px;
  white-space: normal;
  line-height: 1;
}
}

@media screen and (max-width: 650px) {
  .mdc-data-table__cell, .mdc-data-table__header-cell {
  padding: 0 5px 0 4px;
  padding-bottom: 10px;
padding-top: 10px;

}

.mdc-deprecated-list-item__text{
  font-size: 12px;
  white-space: normal;
  line-height: 1;
}
}

@media screen and (max-width: 400px) {
  .mdc-data-table__cell, .mdc-data-table__header-cell {
  padding: 0px;
  font-size: 10px;
}

.mdc-radio {
  margin-right: 0px;
}
}

@media screen and (max-width: 340px) {
  .mdc-data-table__cell, .mdc-data-table__header-cell {
  padding: 0px;
  font-size: 7px;
}

.mdc-radio {
  display: inline-block;
  margin-right: 0px;
  position: relative;
  flex: 0 0 auto;
  box-sizing: content-box;
  width: 15px;
  height: 15px;
  cursor: pointer;
  will-change: opacity,transform,border-color,color;
}
}

#step-2{
  display: none;
}
</style>
{% endblock %}

<main class="s-main-content">
    <div class="container-color-background">
        <div class="mdc-layout-grid container-size-s">
            <div class="mdc-layout-grid__inner">
                <div id="step-0"    class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12-desktop mdc-layout-grid__cell--span-12-tablet">
                    <div class="container-dashboard--messages">
                        <div class="mdc-card mdc-card--color-on-primary">
                            <div id="step-0" class="container-dashboard--messages-list-empty ">
                                <!-- DATOS DE CONTACTO DE LA EMPRESARIA/PROPIETARIA  -->
                                <div class="mdc-layout-grid">
                           
                                      <div class="mdc-layout-grid__inner">
                                        <div class="
                                        mdc-layout-grid__cell--span-12-desktop
                                        mdc-layout-grid__cell--span-12-tablet
                                        mdc-layout-grid__cell--span-12-phone
                                        "
                                        >
                                          <div class="mdc-typography--body1">
                                            <div class="mdc-typography--headline4 s-font-color-secondary">
                                                Encuesta de Satisfacción de los Servicios de Desarrollo Empresarial
                                            </div>
                                            <p><b>
                                              Estimada empresaria</b>
                                            </p>
                                            <div class="mdc-typography--body1" style="text-align: justify;">
                                                ¡Gracias por participar en Innova Mujer Honduras! Valoramos mucho su opinión y nos gustaría conocer su experiencia con la Calidad de los Servicios proporcionados por nuestros Proveedores de Servicios de Desarrollo Empresarial. Le pedimos amablemente su apoyo para responder las siguientes preguntas:
                                            </div>
                                            <br>
                                            <div style="text-align: justify;">
                                              Antes de comenzar, nos gustaría que confirmaras su identidad. Por favor, ingresa su número de identidad con el que se registró en Innova Mujer.
                                            </div>
                                            <br>
                                            <div class="mdc-layout-grid__cell--span-12-desktop  mdc-layout-grid__cell--span-12-tablet mdc-layout-grid__cell--span-12-phone">
                                              <div class="mdc-typography--body1">
                                                Identidad (sin guiones): 
                                            </div>
                                            <label class="mdc-text-field mdc-text-field--filled" id="txt_company_description" data-assigned-var>
                                                <span class="mdc-text-field__ripple"></span>
                                                <span class="mdc-floating-label" id="my-label-id" hiddenlabel="Identidad">Identidad</span>
                                                <input required id="txt_identidad" class="mdc-text-field__input" type="number" aria-labelledby="my-label-id" maxlength="13" oninput="validateInput()">
                                                <span class="mdc-line-ripple"></span>
                                            </label>
                                            <div id="error-message" class="error-message">El número de identidad debe tener exactamente 13 dígitos.</div>
                                            </div>

                                            
                                          </div>
                                        </div>
                                      </div>
                               
                                  
                                    <br>
                                    <center>
      
                                      <button id="submitSaveButton"  class="mdc-button mdc-button--raised mdc-button--icon-leading" onclick="continuarEncuesta()">
                                        <span class="mdc-button__ripple"></span>
                                        <span class="mdc-button__focus-ring"></span>
                                        <i class="material-icons mdc-button__icon" aria-hidden="true"
                                          >bookmark</i
                                        >
                                        <span class="mdc-button__label">Continuar  </span>
                          
                                      </button>
                               
                          
                                    </center>


                                    
                                </div>

                      <!-- fin -->
                            </div>

                        </div>
                    </div>
                </div>
                <div id="step-1"    class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12-desktop mdc-layout-grid__cell--span-12-tablet">
                    <div class="container-dashboard--messages">
                        <div class="mdc-card mdc-card--color-on-primary">

                      
                            <div class="mdc-card__content container-dashboard--messages-cnt">
                                <div class="mdc-typography--headline4 s-font-color-secondary">
                                    Encuesta de Satisfacción de los Servicios de Desarrollo Empresarial
                                </div>

                                <div class="container-dashboard--messages-list-empty ">
                                    <!-- DATOS DE CONTACTO DE LA EMPRESARIA/PROPIETARIA  -->
                                    <div class="mdc-layout-grid">
                                        <div class="mdc-layout-grid__inner">
                                        <div class="
                                        mdc-layout-grid__cell--span-12-desktop
                                        mdc-layout-grid__cell--span-12-tablet
                                        mdc-layout-grid__cell--span-12-phone
                                        "
                                        >
                                            <div class="mdc-typography--body-2">
                                                A.	Datos Generales
                                            </div>
                                        </div>
                                        </div>
                                        <div class="mdc-layout-grid__inner">
                                            <div  class="mdc-layout-grid__cell--span-12-desktop mdc-layout-grid__cell--span-12-tablet mdc-layout-grid__cell--span-12-phone">
                                                <div class="mdc-typography--body1">
                                                    <p><b>Empresa:</b> {{ company.name }}</p>
                                                    <p><b>Empresaria:</b> {{ company.inscripcion.name }}</p>
                                                    <p><b>DNI:</b> {{ company.dni }}</p>
                                                </div>

                                            </div>


                            
                                            <div id="q01" class="mdc-layout-grid__cell--span-12-desktop nquestion mdc-layout-grid__cell--span-12-tablet mdc-layout-grid__cell--span-12-phone">
                                                <div class="mdc-typography--body1">
                                                    <b>1.</b> ¿Qué tan satisfecha está con la calidad de los servicios de desarrollo empresarial recibidos?
                                                </div>
                                                <table class="mdc-data-table__table">
                                                    <thead>
                                                        <tr class="mdc-data-table__header-row">
                                                            <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Mala</th>
                                                            <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Regular</th>
                                                            <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Buena</th>
                                                            <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Muy Buena</th>
                                                            <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Excelente</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody class="mdc-data-table__content">
                                                        <tr class="mdc-data-table__row">
                                                            <td class="mdc-data-table__cell">
                                                                <div class="mdc-radio">
                                                                    <input class="mdc-radio__native-control" type="radio" value="1" name="txt_calificacion_experiencia" id="calificacion_experiencia_1" onclick="handleCalificacionExperienciaChange(1)">
                                                                    <div class="mdc-radio__background">
                                                                        <div class="mdc-radio__outer-circle"></div>
                                                                        <div class="mdc-radio__inner-circle"></div>
                                                                    </div>
                                                                    <div class="mdc-radio__ripple"></div>
                                                                </div>
                                                            </td>
                                                            <td class="mdc-data-table__cell">
                                                                <div class="mdc-radio">
                                                                    <input class="mdc-radio__native-control" type="radio" value="2" name="txt_calificacion_experiencia" id="calificacion_experiencia_2" onclick="handleCalificacionExperienciaChange(2)">
                                                                    <div class="mdc-radio__background">
                                                                        <div class="mdc-radio__outer-circle"></div>
                                                                        <div class="mdc-radio__inner-circle"></div>
                                                                    </div>
                                                                    <div class="mdc-radio__ripple"></div>
                                                                </div>
                                                            </td>
                                                            <td class="mdc-data-table__cell">
                                                                <div class="mdc-radio">
                                                                    <input class="mdc-radio__native-control" type="radio" value="3" name="txt_calificacion_experiencia" id="calificacion_experiencia_3">
                                                                    <div class="mdc-radio__background">
                                                                        <div class="mdc-radio__outer-circle"></div>
                                                                        <div class="mdc-radio__inner-circle"></div>
                                                                    </div>
                                                                    <div class="mdc-radio__ripple"></div>
                                                                </div>
                                                            </td>
                                                            <td class="mdc-data-table__cell">
                                                                <div class="mdc-radio">
                                                                    <input class="mdc-radio__native-control" type="radio" value="4" name="txt_calificacion_experiencia" id="calificacion_experiencia_4">
                                                                    <div class="mdc-radio__background">
                                                                        <div class="mdc-radio__outer-circle"></div>
                                                                        <div class="mdc-radio__inner-circle"></div>
                                                                    </div>
                                                                    <div class="mdc-radio__ripple"></div>
                                                                </div>
                                                            </td>
                                                            <td class="mdc-data-table__cell">
                                                                <div class="mdc-radio">
                                                                    <input class="mdc-radio__native-control" type="radio" value="5" name="txt_calificacion_experiencia" id="calificacion_experiencia_5">
                                                                    <div class="mdc-radio__background">
                                                                        <div class="mdc-radio__outer-circle"></div>
                                                                        <div class="mdc-radio__inner-circle"></div>
                                                                    </div>
                                                                    <div class="mdc-radio__ripple"></div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                                <div class="mdc-layout-grid__cell--span-12-desktop mdc-layout-grid__cell--span-12-tablet mdc-layout-grid__cell--span-12-phone" id="comentarios_calificacion_experiencia" style="display: none;">
                                                    <div class="mdc-typography--body1">
                                                        Si su puntuación fue 1 o 2, comente ¿por qué?
                                                    </div>
                                                    <label class="mdc-text-field mdc-text-field--filled">
                                                        <span class="mdc-text-field__ripple"></span>
                                                        <input class="mdc-text-field__input" type="text" name="txt_comentarios_calificacion_experiencia" placeholder="Especifique">
                                                        <span class="mdc-floating-label" id="my-label-id" hiddenlabel="Especifique">Especifique</span>
                                                        <span class="mdc-line-ripple"></span>
                                                    </label>
                                                </div>
                                            </div>
                                            <div id="q02" class="mdc-layout-grid__cell--span-12-desktop nquestion mdc-layout-grid__cell--span-12-tablet mdc-layout-grid__cell--span-12-phone">
                                                <div class="mdc-typography--body1">
                                                    <b>2.</b> Comentario u observaciones  
                                                </div>
                                                <label class="mdc-text-field mdc-text-field--filled mdc-text-field--textarea">
                                                    <span class="mdc-text-field__ripple"></span>
                                                    <textarea id="txt_recomendaciones" class="mdc-text-field__input" name="txt_recomendaciones" rows="4" placeholder="Escriba sus recomendaciones aquí..."></textarea>
                                                    <span class="mdc-floating-label" id="my-label-id" hiddenlabel="Escriba sus Comentario u observaciones ">Escriba sus recomendaciones</span>
                                                    <span class="mdc-line-ripple"></span>
                                                </label>
                                            </div>
                                
                                        </div>
                                        
                                    </div>

                        <!-- fin -->
                                </div>
                            </div>
                            <div class="mdc-card__actions" style="margin: auto">
                                <div class="mdc-card__action-buttons">
                                <center>

                                  <button id="submitSaveButton"   class="mdc-button mdc-button--raised mdc-button--icon-leading" onclick="saveRegisterForms()">
                                    <span class="mdc-button__ripple"></span>
                                    <span class="mdc-button__focus-ring"></span>
                                    <i class="material-icons mdc-button__icon" aria-hidden="true"
                                      >bookmark</i
                                    >
                                    <span class="mdc-button__label">Aceptar  </span>
                      
                                  </button>
                                  <!--
                                  <button class="mdc-button mdc-button--outlined">
                                    <span class="mdc-button__ripple"></span>
                                    <span class="mdc-button__focus-ring"></span>
                                    <span class="mdc-button__label">Continuar después  </span>
                                  </button>-->
                                </center>
                                </div>

                            </div>
                        </div>
                     
                    </div>
                </div>

                <div id="step-2" class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12-desktop mdc-layout-grid__cell--span-12-tablet">
                  <div class="container-dashboard--messages">
                    <div class="mdc-card mdc-card--color-on-primary">

                      <div class="mdc-card__content container-dashboard--messages-cnt">

                        <p>Gracias por inscribirte en INNOVA MUJER HONDURAS</p>

                        <p>En breve estarás recibiendo un correo electrónico a tu cuenta"<spam id="corre_empresaria" style="font-weight: bold;" >ma@yahoo.com</spam>" con la que te has registrado, con la información necesaria para continuar con tu proceso de formación empresarial.
                        </p>
                        <p>Saludos</p>
                      </div>
                    </div>
                  </div>
                </div>
            </div>
        </div>
    </div>

</main>
{% endblock %}
{% block body_script_section %}
<script src="{{ url_for('static', filename='js/bundle/home-dashboard.min.js') }}"></script>

<script>
    function handleTecnologiaChange(answer) {
        if (answer === 'SI') {
            // Code to show question 3
            document.getElementById("q02").style.display = "block";
            document.getElementById("q03").style.display = "block";
        } else if (answer === 'NO') {
            // Code to show question 4
            document.getElementById("q02").style.display = "none";
            document.getElementById("q03").style.display = "none";
        }
    }

    
    </script>

<script>

</script>
<script>


    function handleCalificacionExperienciaChange(value) {
        var comentariosField = document.getElementById('comentarios_calificacion_experiencia');
        if (value === 1 || value === 2) {
            comentariosField.style.display = 'block';
        } else {
            comentariosField.style.display = 'none';
        }
    }


    function guardarRespuestas() {
        const Swal = swcms.returnSwal()
        let respuestas = [];
        let salto = true;
        let saltoq9 = true;
        // Selecciona todas las preguntas
        let preguntas = document.querySelectorAll('.nquestion'); // Ajusta el selector según tu HTML
        let idsGrupoEspecial = [];
    
    
        for (let pregunta of preguntas) {
            // Obtener el título de la pregunta
            let tituloElement = pregunta.querySelector('.mdc-typography--body1, .mdc-typography--headline4');

            // Verificar si el título existe
            if (!tituloElement) {
                console.warn('No se encontró el título de la pregunta:', pregunta);
                continue; // Saltar a la siguiente iteración si el título no existe
            }

            let ids = pregunta.id;
            let tituloPregunta = tituloElement.textContent.trim();

            // Obtener todas las opciones de respuesta
            let opcionesRespuesta = pregunta.querySelectorAll('input[type="radio"]:checked, input[type="checkbox"]:checked, input[type="number"], input[type="text"]');
            let hayrespuesta = false;
            let ifotro = false;

            let respuestasPregunta = [];
            console.log(tituloPregunta)
    
            if (idsGrupoEspecial.includes(ids)) {
                hayrespuesta = true
                respuestasPregunta.push([]);
            }
            opcionesRespuesta.forEach((opcion) => {
                console.log('tituloPregunta')
                console.log(ids,opcion.value)
                if (idsGrupoEspecial.includes(ids)) {
                    hayrespuesta = true
                    respuestasPregunta.push([]);
                    return 
                }
                if (opcion.type === 'checkbox' || opcion.type === 'radio') {
                    if (opcion.checked) {
                        if (ids === 'q01' && opcion.value === '1' || opcion.value === '2' ) {
                            respuestasPregunta.push(opcion.value);
                            ifotro = true;
                           
                        }else{
                            respuestasPregunta.push(opcion.value);
                            hayrespuesta = true;
                           
                        }
                    }
                } else if (opcion.type === 'number' || opcion.type === 'text' || opcion.type === 'textarea') {
                   
                    if (salto==true){
                       
                    if (ifotro && opcion.value.trim() !== "") {
                        hayrespuesta = true;
                        respuestasPregunta.push(opcion.value);
                    } 
                    
                    
                }
                    
                }
            });
          
            if (ids === 'q02') {
                txt_recomendaciones = document.getElementById('txt_recomendaciones').value;
                if (txt_recomendaciones.trim() !== ""){
                    respuestasPregunta.push(txt_recomendaciones)
                    console.log(respuestasPregunta)
                    hayrespuesta = true;
                }
            }
            if (hayrespuesta) {
                respuestas.push({
                    ids: ids,
                    titulopregunta: tituloPregunta,
                    Respuestas: respuestasPregunta
                });
                console.log(respuestas)
            } else {
                console.log('Por favor responder la pregunta: ' + tituloPregunta);
                Swal.fire(
                'Error',
                'Por favor responder la pregunta: ' + tituloPregunta,
                'error'
                )
                return false; // Detener la función
            }
        }

        return respuestas;
    }




function saveRegisterForms(){
    const Swal = swcms.returnSwal()
    let arrayRespuestas = guardarRespuestas();
    console.log(arrayRespuestas)

    if(arrayRespuestas){
            let postData = {
            "txt_company":'{{company.id}}',
            "txt_preguntas":arrayRespuestas
            };

            console.log(postData)

            let apiUrl = '/api/save/catalog/surveys/dis';


            swcms.postFetch(apiUrl, postData).then((data) => {
                Swal.fire(
                'Éxito',
                'Encuesta Guardad con Exito',
                'success'
                )
                window.setTimeout(() => { 
                    window.location.href = '/welcome/'; 

                }, 1500);

            }).catch((error) => {
                Swal.fire(
                'Error de conexión',
                'Por favor revisar tu conexión a internet, si el problema persiste contacta al administrador del sistema',
                'error'
                )
                document.getElementById('btn_generar_ficha').disabled = false;
            });
        }
  //  if (validarFormularioCompleto()) {
  //      let arrayRespuestas = guardarRespuestas();
  //      console.log(arrayRespuestas);
  //  }

}
function validarFormularioCompleto() {
    let preguntas = document.querySelectorAll('.nquestion');
    let camposIncompletos = [];
    let respuestasx = [];
    preguntas.forEach((pregunta, index) => {
        let tituloElement = pregunta.querySelector('.mdc-typography--body1, .mdc-typography--headline4');
        let idpregunta = pregunta.id;


      
        let tituloPregunta = tituloElement ? tituloElement.textContent.trim() : `Pregunta ${index + 1}`;
       
        let opcionesRadioCheckbox = pregunta.querySelectorAll('input[type="radio"], input[type="checkbox"]');
        let opcionesText = pregunta.querySelectorAll('input[type="text"], input[type="number"]');
        let tieneOpciones = opcionesRadioCheckbox.length > 0;
        let tieneTexto = opcionesText.length > 0;
        console.log()
        let seleccionada = false;

        if (tieneOpciones) {
            seleccionada = Array.from(opcionesRadioCheckbox).some(opcion => opcion.checked);
            console.log()
        }

        if (tieneTexto) {
            seleccionada = Array.from(opcionesText).some(opcion => opcion.value.trim() !== "");
        }

        if (!seleccionada) {
            camposIncompletos.push(tituloPregunta);
        }
    });
 
    if (camposIncompletos.length > 0) {
        alert('Por favor, complete las siguientes preguntas antes de continuar:\n' + camposIncompletos.join('\n'));
        return false;
    }

    return false;
}

function validarNumero(input) {
    let value = input.value;
    // Elimina cualquier carácter que no sea un número y asegúrate de que el valor sea positivo
    input.value = value.replace(/[^0-9]/g, '');
}


function continuarEncuesta(){
       
       const Swal = swcms.returnSwal()
         const identidad = document.getElementById('txt_identidad');
         const empresa_id = '{{company.dni }}'

         if (identidad.value==empresa_id){
           var div = document.getElementById('step-0');
             div.style.display = 'none';
             var div = document.getElementById('step-1');
             div.style.display = 'block';

         }else{
           Swal.fire(
             'Identidad no encontrada',
             'Por favor contacta a su especialista',
             'error'
           )
         }
     
      }

      document.addEventListener("DOMContentLoaded", function() {
            
            var div = document.getElementById('step-1');
            div.style.display = 'none';
        });
</script>
    

{% endblock %}
