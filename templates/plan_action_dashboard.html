{% extends 'layout_main-drawer--dismissible_footer_topbar.html' %}
{% block page_description %}Innova Mujer Home, Casa, Dashboard, Home{% endblock %}
{% block page_title %}Innova Mujer Home{% endblock %}
{% block css_script_section %}
<style>
    .alignleft {
	float: left;
    }
    .alignright {
        float: right;
    }
    .center-text { 
        margin: 0 auto; 
        text-align: center;
    }
</style>
{% endblock %}
{% block body %}
<main class="s-main-content">
    <div class="container-color-background">
        <div class="mdc-layout-grid container-size-s">
            <div class="mdc-layout-grid__inner">
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12-desktop mdc-layout-grid__cell--span-12-tablet mdc-layout-grid__cell--span-12-phone">
                    <div class="container-dashboard--messages">
                        <div class="mdc-card mdc-card--color-on-primary">
                            <div class="mdc-tab-bar" role="tablist" data-action-fn="showMessagesContracts">
                                <div class="mdc-tab-scroller">
                                    <div class="mdc-tab-scroller__scroll-area">
                                        <div class="mdc-tab-scroller__scroll-content">
                                            <button class="mdc-tab mdc-tab--active" role="tab" aria-selected="true" tabindex="0">
                                                <span class="mdc-tab__content">
                                                    <span class="mdc-tab__text-label">EMPRESA: {{ company.name }}</span>
                                                </span>
                                                <span class="mdc-tab-indicator mdc-tab-indicator--active">
                                                    <span class="mdc-tab-indicator__content mdc-tab-indicator__content--underline"></span>
                                                </span>
                                                <span class="mdc-tab__ripple"></span>
                                            </button>

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mdc-card__content container-dashboard--messages-msg">
                                <div class="mdc-layout-grid__inner">
                                    <div class="mdc-layout-grid__cell--span-12-desktop  mdc-layout-grid__cell--span-12-tablet mdc-layout-grid__cell--span-12-phone">
                
                                        <br>
                                        {% if diagnostico %} 
                                            {% if actions %}
                                                <table class="mdc-data-table__table_normal" aria-label="Dessert calories">
                                                    <thead>
                                                    <tr class="mdc-data-table__header-row">
                                                        <th class="mdc-data-table__header-cell" role="columnheader" scope="col">#</th>
                                                        <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Acciones </th>
                                                        <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Servicio </th>
                                                        <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Area</th>
                                                        <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Referirencias</th>
                                                        <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Fecha Inicio</th>
                                                        <th class="mdc-data-table__header-cell" role="columnheader" scope="col">Fecha Final</th>
                                                        <th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric" role="columnheader" scope="col">Progreso</th>
                                                    </tr>
                                                    
                                                    
                                                    
                                                    </thead>
                                                    <tbody class="mdc-data-table__content">
                                                    {% for action in actions %}                                   
                                                    <tr class="mdc-data-table__row">
                                                        <th class="mdc-data-table__cell" scope="row">
                                                            {{loop.index}}
                                                        </th>
                                                        <th class="mdc-data-table__cell" scope="row">
                                                            <a href="{{ url_for('digitalcenter._plan_action_bitacora',user_uid=action.id) }}" class="mdc-button mdc-button--raised mdc-button--leading" style="--mdc-ripple-fg-size: 75px; --mdc-ripple-fg-scale: 1.8784232240642684; --mdc-ripple-fg-translate-start: 16.41668701171875px, -7.866668701171875px; --mdc-ripple-fg-translate-end: 25.416671752929688px, -19.5px;">
                                                        
                                                                <span class="mdc-button__ripple"></span>
                                                                <i class="material-icons mdc-button__icon" aria-hidden="true">check</i>
                                                                <span class="mdc-button__label">Añadir historial</span>
                                                            </a>
                                                        </th>
                                                        <th class="mdc-data-table__cell" scope="row">
                                                            {{action.services.name}}
                                                        </th>
                                                        <th class="mdc-data-table__cell" scope="row">
                                                            {{action.services.catalog_catego.name}}
                                                        </th>
                                                        <th class="mdc-data-table__cell" scope="row">
                                                            {% if action.employe_assigned %}
                                                                YA ASIGNADO
                                                            {% else %}
                                                            <select id="txt_user_{{action.id}}">
                                                                <option value="0">--</option>
                                                                {% for user in users %}
                                                                <option value="{{ user.id }}">
                                                                    {{ user.extra_info.names }}
                                                                    {{ user.extra_info.last_names}}
                                                                    
                                                                </option>
                                                                {% endfor %}
                                                            </select>
                                                            <button onclick="referirEmpresaria('{{action.id}}')">
                                                                Referir
                                                            </button>
                                                            {% endif %}
                                                            
                                                        </th>
                                                        <th class="mdc-data-table__cell mdc-data-table__header-cell--numeric" scope="row">
                                                            {{action.date_scheduled_start.strftime('%Y-%m-%d') }}

                                                        </th>
                                                        <th class="mdc-data-table__cell mdc-data-table__header-cell--numeric" scope="row">
                                                            {{action.date_scheduled_end.strftime('%Y-%m-%d') }}

                                                        </th>
                                                        <th class="mdc-data-table__cell mdc-data-table__header-cell--numeric" scope="row">
                                                            {{action.progress}}

                                                        </th>
                                
                                                    </tr>
                                                    {% endfor %}
                
                                                    </tbody>
                                                </table>
                                            {% else %}
                                            <div class="center-text">
                                                <h2>Plan de acción no ha sido encontrado</h2>

                                                <a href="{{ url_for('digitalcenter._plan_action_create',user_uid=company.id ) }}" class="mdc-button mdc-button--raised mdc-button--leading" style="--mdc-ripple-fg-size: 75px; --mdc-ripple-fg-scale: 1.8784232240642684; --mdc-ripple-fg-translate-start: 16.41668701171875px, -7.866668701171875px; --mdc-ripple-fg-translate-end: 25.416671752929688px, -19.5px;">
                                                    
                                                    <span class="mdc-button__ripple"></span>
                                                    <i class="material-icons mdc-button__icon" aria-hidden="true">check</i>
                                                    <span class="mdc-button__label">Crear plan de acción</span>
                                                </a>
                                            </div>
                                            {% endif %}
                                        {% else %}
                                        <div class="center-text">
                                            <h2>Diagnóstico empresarial no ha sido enviado encontrado</h2>

                                            <a href="{{ url_for('digitalcenter._diagnosis_monitoring_list') }}" class="mdc-button mdc-button--raised mdc-button--leading" style="--mdc-ripple-fg-size: 75px; --mdc-ripple-fg-scale: 1.8784232240642684; --mdc-ripple-fg-translate-start: 16.41668701171875px, -7.866668701171875px; --mdc-ripple-fg-translate-end: 25.416671752929688px, -19.5px;">
                                                
                                                <span class="mdc-button__ripple"></span>
                                                <i class="material-icons mdc-button__icon" aria-hidden="true">check</i>
                                                <span class="mdc-button__label">Enviar primer diagnóstico empresarial</span>
                                            </a>
                                        </div>

                                        {% endif %}

                                    </div>
    
                                    
                                </div>
    
                            </div>
            
                                
                            


                            <div class="mdc-card__actions">
                                <div class="mdc-card__actions-buttons">
                                </div>
                                <div class="mdc-card__action-icons">
                                    <button class="mdc-icon-button material-icons mdc-card__action mdc-card__action--icon">
                                        <div class="mdc-icon-button__ripple"></div>
                                        more_vert
                                    </button>
                                </div>
                            </div>
                        
                        
                    </div>
                    </div>
                </div>
            

         

            </div>
        </div>
    </div>
 
</main>
{% if diagnostico %} 
<main class="s-main-content">
    <div class="container-color-background">
        <div class="mdc-layout-grid container-size-s">
            <div class="mdc-layout-grid__inner">
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-6">
                    <div class="container-dashboard--card-info">
                        <div class="mdc-card mdc-card--color-on-primary">
                            <div class="mdc-card__content">
                                <div class="mdc-typography--headline5 s-font-color-secondary">Resultados</div>
                                <br>
                                <table class="mdc-data-table__table_normal" aria-label="Dessert calories">
                                    <thead>
                                      <tr class="mdc-data-table__header-row">
                                        <th class="mdc-data-table__header-cell" role="columnheader" scope="col">#</th>
                                        <th class="mdc-data-table__header-cell" role="columnheader" scope="col">AREA </th>
                                        <th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric" role="columnheader" scope="col">PUNTAJE TOTAL DEL AREA</th>
                                        

                                        <th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric" role="columnheader" scope="col">IDEALES</th>
                                        <th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric" role="columnheader" scope="col">Resultados</th>
                                      </tr>
                                      
                                      
                                      




                                    </thead>
                                    <tbody class="mdc-data-table__content">
                                    {% for resultado in diagnostico %}                              
                                      <tr class="mdc-data-table__row">
                                        <th class="mdc-data-table__cell" scope="row">
                                            {{loop.index}}
                                        </th>
                                        <th class="mdc-data-table__cell" scope="row">
                                            {{ resultado.area }}
                                        </th>
                                        <td class="mdc-data-table__cell mdc-data-table__header-cell--numeric" scope="row">
                                            {{ resultado.putaje_area }}
                                        </td>
                                        <td class="mdc-data-table__cell mdc-data-table__header-cell--numeric" scope="row">
                                            {{ resultado.ideales }}
                                        </td>
                                        <td class="mdc-data-table__cell mdc-data-table__header-cell--numeric" scope="row">
                                            {{ resultado.resultados }}  
                                        </td>     
                                      </tr>
                                    {% endfor %}
                                    </tbody>
                                  </table>
                            </div>
                            <div class="mdc-card__actions">
                                <div class="mdc-card__actions-buttons"></div>
                                <div class="mdc-card__action-icons">
                                    <button class="mdc-icon-button material-icons mdc-card__action mdc-card__action--icon">
                                        <div class="mdc-icon-button__ripple"></div>
                                        more_vert
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-6">
                    <div class="container-dashboard--card-info">
                        <div class="mdc-card mdc-card--color-on-primary">
                            <div class="mdc-card__content">
                                <div class="mdc-typography--headline5 s-font-color-secondary">RESULTADOS POR CATEGORIA</div>
                                <br>
                                <div id="curve_chart" style="width: 100%; height: 500px"></div>

                            </div>
                            <div class="mdc-card__actions">
                                <div class="mdc-card__actions-buttons"></div>
                                <div class="mdc-card__action-icons">
                                    <button class="mdc-icon-button material-icons mdc-card__action mdc-card__action--icon">
                                        <div class="mdc-icon-button__ripple"></div>
                                        more_vert
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-6">
                    <div class="container-dashboard--card-info">
                        <div class="mdc-card mdc-card--color-on-primary">
                            <div class="mdc-card__content">
                                <div class="mdc-typography--headline5 s-font-color-secondary">RESULTADOS POR CATEGORIA</div>
                                <br>
                    
                                <div id="donutchart" style="width: 100%; height: 500px;"></div>

                            </div>
                            <div class="mdc-card__actions">
                                <div class="mdc-card__actions-buttons"></div>
                                <div class="mdc-card__action-icons">
                                    <button class="mdc-icon-button material-icons mdc-card__action mdc-card__action--icon">
                                        <div class="mdc-icon-button__ripple"></div>
                                        more_vert
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-6">
                    <div class="container-dashboard--card-info">
                        <div class="mdc-card mdc-card--color-on-primary">
                            <div class="mdc-card__content">
                                <div class="mdc-typography--headline5 s-font-color-secondary">RESULTADO DEL DIAGNOSTICO</div>
                                <br>
                    
                                <table class="mdc-data-table__table_normal" aria-label="Dessert calories">
                                    <thead>
                                      <tr class="mdc-data-table__header-row">
                                        <th class="mdc-data-table__header-cell" role="columnheader" scope="col">#</th>
                                        <th class="mdc-data-table__header-cell" role="columnheader" scope="col">TIPO EMPRESA </th>
                                        <th class="mdc-data-table__header-cell mdc-data-table__header-cell--numeric" role="columnheader" scope="col">RESULTADO</th>
                                      </tr>
                                      
                                      
                                      
                                    </thead>
                                    <tbody class="mdc-data-table__content">
                                                                             
                                      <tr class="mdc-data-table__row">
                                        <th class="mdc-data-table__cell" scope="row">
                                           1
                                        </th>
                                        <th class="mdc-data-table__cell" scope="row">
                                            {{tipo_empresa}}
                                        </th>
                                        <td class="mdc-data-table__cell mdc-data-table__header-cell--numeric" scope="row">
                                            {{ totaldiagnostico }}
                                        </td>
                
                                      </tr>


                                    </tbody>
                                  </table>

                            </div>
                            <div class="mdc-card__actions">
                                <div class="mdc-card__actions-buttons"></div>
                                <div class="mdc-card__action-icons">
                                    <button class="mdc-icon-button material-icons mdc-card__action mdc-card__action--icon">
                                        <div class="mdc-icon-button__ripple"></div>
                                        more_vert
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main> 
{% endif %}

{% endblock %}
{% block body_script_section %}
    <script src="{{ url_for('static', filename='js/bundle/home-dashboard.min.js') }}"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    {% if diagnostico %} 

        <script type="text/javascript">
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
            var data = google.visualization.arrayToDataTable([
            ['AREA', 'IDEALES', 'RESULTADOS'],
            
            {% for resultado in diagnostico %}    
                {% if resultado.id_area != 0  %}
                ['{{resultado.area}}',  {{resultado.ideales}}, {{resultado.resultados}}],
                {% endif %}
            {% endfor %}
            ]);
        
            var options = {
            title: 'RESULTADOS POR CATEGORIA',
            curveType: 'function',
            legend: { position: 'bottom' }
            };

            var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));

            chart.draw(data, options);
        }
        </script>

        <script type="text/javascript">
            google.charts.load("current", {packages:["corechart"]});
            google.charts.setOnLoadCallback(drawChart);
            function drawChart() {
                var data = google.visualization.arrayToDataTable([
                    ['AREA', 'RESULTADOS'],
                    {% for resultado in diagnostico %}    
                        {% if resultado.id_area != 0  %}
                    ['{{resultado.area}}',     {{resultado.resultados}}],
                    {% endif %}
            {% endfor %}
                ]);

                var options = {
                title: 'RESULTADOS POR CATEGORIA',
                pieHole: 0.4,
                };

                var chart = new google.visualization.PieChart(document.getElementById('donutchart'));
                chart.draw(data, options);
            }
        </script>

    {% endif %}

    <script>
        function referirEmpresaria(action_id){
            const Swal = swcms.returnSwal()
            let txt_user_x = document.getElementById('txt_user_'+action_id).value 

            let postData = {
                "txt_action_id": action_id,
                "txt_user_x": txt_user_x,
                };
                console.log(postData)
                let apiUrl = '/api/created/reference/';
                //document.getElementById('submitSaveButton').disabled = true;

                swcms.postFetch(apiUrl, postData).then((data) => {
                    Swal.fire(
                    'Éxito',
                    'Plan de Acción creado!',
                    'success'
                    )
                    window.setTimeout(() => { window.location.reload(); }, 1500);
                
                }).catch((error) => {
                    Swal.fire(
                    'Error de conexión',
                    'Por favor revisar tu conexión a internet, si el problema persiste contacta al administrador del sistema',
                    'error'
                    )
                    //document.getElementById('submitSaveButton').disabled = false;
                });
        }
    </script>
{% endblock %}